<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Falcão Real | Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/cadastro.css" />
  <link rel="icon" href="./assets/icon/favicon2.ico" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
</head>

<body>
  <div class="header">
    <div class="botao_header">
      <a href="./index.html">
        <button class="btn_login">Voltar</button>
      </a>
    </div>
  </div>

  <div class="container">

    <div class="dados">

      <div class="introducao">

        <div class="icone_formulario">
          <img src="./assets/img_formulario.png">
        </div>
        <h3>Formulário de Inscrição</h3>
      </div>

      <div id="botao_login_cadastrar">
        <button onclick="logar()" id="botao_login">Login</button>
        <button id="botao_cadastrar">Cadastrar</button>
      </div>


      <div id="campos1">

        <div id="par_inputs">
          <div id="nasc">
            <label class="label_dtNasc" for="input_dtNasc">Data de Nascimento</label><br>
            <input maxlength="10" oninput="formatar_dtNasc()" type="date" placeholder="dd/mm/aaaa"
              id="input_dtNasc"><br>
            <span id="dtNasc_span"></span>
          </div>

          <div id="Telefone">
            <label for="input_telefone">Telefone</label><br>
            <input maxlength="15" oninput="validar_telefone()" type="text" placeholder="(00) 00000-0000"
              id="input_telefone"><br>
            <span id="telefone_span"></span>
          </div>
        </div>

        <div id="par_inputs2">
          <div id="cpf">
            <label for="input_cpf">CPF</label><br>
            <input maxlength="14" oninput="validar_cpf()" type="text" placeholder="000.000.000-00" id="input_cpf"><br>
            <span id="cpf_span"></span>
          </div>

          <div id="genero">
            <label for="input_rg">Gênero</label><br>
            <select id="select_genero">
              <option selected value="#">Selecione uma Opção</option>
              <option value="F">Feminino</option>
              <option value="M">Masculino</option>
            </select>
          </div>
        </div>

        <div id="botao_avancar">
          <button id="avancar" onclick="avancar(1)">Avançar</button>
        </div>

      </div>

      <!--

      

      <div id="campos2" style="display: none;">

        <div id="responsavel">
          <h3>Dados do Responsável</h3>
        </div>


        <div id="par_inputsP2">

          <div id="telefone_responsavel">
            <label for="input_telefone_responsavel">Telefone do Responsável</label><br>
            <input type="text" placeholder="(00) 00000-0000" id="input_telefone_responsavel"><br>
          </div>

          <div id="email_responsavel">
            <label for="input_email_responsavel">Telefone do Responsável</label><br>
            <input type="text" placeholder="meuEmail@sptech.school" id="input_email_responsavel"><br>
          </div>

        </div>

        <div id="botao_avancar_voltar">
          <button id="voltar" onclick="voltar(2)">Voltar</button>
          <button id="avancar" onclick="avancar(2)">Avançar</button>
        </div>

      </div>

      <div id="campos3" style="display: none;">

        <div id="documentos">
          <h3>Documentação</h3>
        </div>


        <div id="par_inputsP3">
          <div id="documento_de_registro">
            <label for="input_documento_de_registro">Documento de Registro</label><br>
            <input type="text" placeholder="Clique para fazer upload" id="input_documento_de_registro">
          </div>

          <div id="comprovante_endereco">
            <label for="input_comprovante_endereco">Comprovante de Endereço Recente</label><br>
            <input type="text" placeholder="Clique para fazer upload" id="input_comprovante_endereco">
          </div>
        </div>

        <div id="par_inputs2P3">
          <div id="doc_cpf">
            <label for="input_doc_cpf">CPF</label><br>
            <input type="text" placeholder="Clique para fazer upload" id="input_doc_cpf"><br>
          </div>

          <div id="vacinacao">
            <label for="input_vacinacao">Carteirinha de Vacinação Atualizada</label><br>
            <input type="text" placeholder="Clique para fazer upload" id="input_vacinacao"><br>
          </div>
        </div>


        <div id="doc_identificacao">
          <label for="input_doc_identificacao">Documento de Identificação</label><br>
          <input type="text" placeholder="Clique para fazer upload" id="input_doc_identificacao"><br>
        </div>

        <div id="botao_avancar_voltar">
          <button id="voltar" onclick="voltar(3)">Voltar</button>
          <button id="avancar" onclick="avancar(3)">Avançar</button>
        </div>

      </div>

      <div id="campos4" style="display: none;">

        <div id="par_trios">



          <div id="trio_inputsP4_container">

            <h3>Tamanhos</h3>

            <div class="trio_inputs">
              <div id="tam_camiseta">
                <label for="input_tam_camiseta">Tamanho de Camiseta</label><br>
                <input type="text" placeholder="Selecione" id="input_tam_camiseta">
              </div>

              <div id="tam_blusao">
                <label for="input_tam_blusao">Tamanho de Blusão</label><br>
                <input type="text" placeholder="Selecione" id="input_tam_blusao">
              </div>

              <div id="tam_calca">
                <label for="input_tam_calca">Tamanho de Blusão</label><br>
                <input type="text" placeholder="Selecione" id="input_tam_calca">
              </div>
            </div>
          </div>



          <div id="trio_inputs2P4_container">

            <h3>Informações Adicionais</h3>

            <div class="trio_inputs">
              <div id="sus">
                <label for="input_sus">Carteirinha SUS</label><br>
                <input type="text" placeholder="Selecione" id="input_sus"><br>
              </div>

              <div id="convenio">
                <label for="input_convenio">Carteirinha do Convênio</label><br>
                <input type="text" placeholder="Selecione" id="input_convenio"><br>
              </div>

              <div id="batizado">
                <label for="input_batizado">É Batizado?</label><br>
                <input type="text" placeholder="Selecione" id="input_batizado"><br>
              </div>
            </div>

          </div>
        </div>

        <div id="botao_avancar_voltar">
          <button id="voltar" onclick="voltar(4)">Voltar</button>
          <button id="avancar" onclick="avancar(4)">Avançar</button>
        </div>

      </div>
        -->
      <div id="campos5" style="display: none;">

        <div id="par_inputs">
          <div id="nome">
            <label for="input_nome">Nome Completo</label><br>
            <input type="text" placeholder="Seu nome completo" id="input_nome" value="Claudio Frizzarini">
          </div>

          <div id="senha">
            <label for="input_senha">Senha</label><br>
            <input oninput="validar_senha()" type="password" placeholder="Sua Senha" id="input_senha" value="12345678f"><br>
            <span id="senha_span"></span>
          </div>
        </div>

        <div id="par_inputs2">
          <div id="email">
            <label for="input_email">E-mail</label><br>
            <input oninput="validar_email()" type="text" placeholder="seu@email.com" id="input_email" value="frizza@gmail.com"><br>
            <span id="email_span"></span>
          </div>

          <div id="confirmar_senha">
            <label for="input_confirmar_senha">Confirmar senha</label><br>
            <input oninput="confirmar_senha()" type="password" placeholder="Confirme sua senha"
              id="input_confirmar_senha" value="12345678f"><br>
            <span id="confirmar_senha_span"></span>
          </div>
        </div>

        <div id="botao_criarConta">
          <button id="voltar" onclick="voltar(5)">Voltar</button>
          <button id="avancar" onclick="cadastrar()">Criar Conta</button>
        </div>

      </div>


    </div>




  </div>

</body>

</html>

<script>

  function logar() {
    window.location = "./login.html"
  }

  function avancar(pagina) {
    if (pagina === 1) {
      campos1.style.display = "none";
      campos5.style.display = "flex";
    }
    /*
    else if (pagina === 2) {
      botao_login_cadastrar.style.display = "none";
      campos2.style.display = "none";
      campos3.style.display = "flex";
    }

    else if (pagina === 3) {
      botao_login_cadastrar.style.display = "none";
      campos3.style.display = "none";
      campos4.style.display = "flex";
    }

    else if (pagina === 4) {
      campos4.style.display = "none";
      campos5.style.display = "flex";
      botao_login_cadastrar.style.display = "flex";
    }
    */
  }




  function voltar(pagina) {

    if (pagina === 5) {
      campos1.style.display = "flex";
      campos5.style.display = "none";
    }

    /*
    if (pagina === 2) {
      botao_login_cadastrar.style.display = "flex"
      campos1.style.display = "flex";
      campos2.style.display = "none";
    }

    else if (pagina === 3) {
      botao_login_cadastrar.style.display = "none";
      campos3.style.display = "none";
      campos2.style.display = "flex";
    }

    else if (pagina === 4) {
      botao_login_cadastrar.style.display = "none";
      campos3.style.display = "flex";
      campos4.style.display = "none";
    }

    else if (pagina === 5) {
      botao_login_cadastrar.style.display = "none";
      campos4.style.display = "flex";
      campos5.style.display = "none";
    }
  
  */
  }

  // Array para armazenar empresas cadastradas para validação de código de ativação 
  // let listaEmpresasCadastradas = [];

  var emailValido = trueOrFalse;
  var senhaValida = trueOrFalse;

  function validar_email() {
    var email = input_email.value;

    if (email.endsWith('sptech.school') ||
      email.endsWith('.com') ||
      email.endsWith('.com.br')
    ) {

      for (cont = 0; cont < email.length; cont++) {
        if (email[cont] === '@') {
          input_email.style.border = 'solid 2px #28DF99';
          email_span.innerHTML = '';
        }
      }

      emailValido = true;

    }
    else {
      input_email.style.border = 'solid 2px red'
      email_span.innerHTML = 'Formato de email inválido'
    }
  }

  var telefoneLength = 0;
  function validar_telefone() { //Função que verifica se o telefone é válido
    var invalidos = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']
    var contador = 0

    for (var i = 0; i < invalidos.length; i++) {
      var atual = invalidos[i];
      console.log('1', i);
      console.log('2', atual);
      console.log('3', input_telefone);
      console.log('4', input_telefone.value.toLowerCase().replaceAll(atual, ''));

      input_telefone.value = input_telefone.value.toLowerCase().replaceAll(atual, '');
    }

    var telefone = input_telefone.value

    while (contador < 15) { //Enquanto o contador for menor que 15(Número de caracteres máximo do telefone com as formatações)
      contador++
      if (telefone.length == 15) { //Se o tamanho do telefone for igual a 15, ele é válido
        telefone_span.innerHTML = ''
        input_telefone.style.border = 'solid 2px #28DF99'
      } else {
        telefone_span.innerHTML = 'Formato de telefone inválido'
        input_telefone.style.border = 'solid 2px red'
      }
    }

    //Formatação do telefone
    if (telefoneLength <= telefone.length) {
      if (telefone.length == 2) { //Se o tamanho do telefone for igual a dois, adiciona parênteses entre os número
        input_telefone.value = '(' + telefone + ') '
      } else if (telefone.length == 10) { //Se o tamanho do telefone for igual a 10, adiciona um traço antes dos 4 últimos números
        input_telefone.value += '-'
      }
    }
    telefoneLength = input_telefone.value.length;
  }

  var dtNascLength = 0;
  function formatar_dtNasc() {

    var dtNascVar = input_dtNasc.value;

    // if(isNaN(input_dtNasc.value)){
    //   dtNasc_span.innerHTML = 'Formato inválido!'
    // }

}

  var cpfLength = 0;
  function validar_cpf() { // Função que valida o CPF
    dtNasc_span.innerHTML = ''
    var cpf = input_cpf.value
    var contador = 0

    while (contador < 14) { //Enquanto o contador for menor que 14(Número máximo de caracteres com a formatação do CPF)
      contador++

      if (cpf.length == 14) { //Se o tamanho do CPF inserido for igual a 14, ele é válido
        cpf_span.innerHTML = '';
        input_cpf.style.border = 'solid 2px #28DF99';
      } else {
        cpf_span.innerHTML = 'Formato de CPF inválido';
        input_cpf.style.border = 'solid 2px red';
      }

    }
    if (cpfLength <= cpf.length) {
      if (cpf.length == 3 || cpf.length == 7) { //Se o tamanho do CPF for igual a 3 ou igual a 7, adiciona um ponto antes dos números seguintes
        input_cpf.value += '.'
      } else if (cpf.length == 11) { //Se o tamanho do CPF inserido for igual a 11, adiciona um traço antes dos dígitos finais
        input_cpf.value += '-'
      }
    }
    cpfLength = input_cpf.value.length;
  }

  function validar_senha() { //Função que valida a Senha inserida
    var senha = input_senha.value

    if (senha.length < 8) { //Se o tamanho da senha for menor que 8 caracteres, ela não será válida
      senha_span.innerHTML = 'Senha necessita de, no mínimo, 8 caracteres'
      input_senha.style.border = 'solid 2px red'
    } else {
      senha_span.innerHTML = ''
      input_senha.style.border = 'solid 2px #28DF99'
      senhaValida = true;
    }
  }

  function confirmar_senha() { //Função que valida a senha repetida
    var senha = input_senha.value
    var senhaRepetida = input_confirmar_senha.value

    if (senhaRepetida !== senha || senhaRepetida.length < 8) { //Se as senhas forem diferentes ou se o tamanho da senha repetida for menor que 8, a senha repetida será inválida
      confirmar_senha_span.innerHTML = 'As senhas precisam ser iguais'
      input_confirmar_senha.style.border = 'solid 2px red'
    } else {
      confirmar_senha_span.innerHTML = ''
      input_confirmar_senha.style.border = 'solid 2px #28DF99'
    }
  }

  function cadastrar() {


    var nomeVar = input_nome.value;
    var emailVar = input_email.value;
    var senhaVar = input_senha.value;
    var confirmacaoSenhaVar = input_confirmar_senha.value;
    var dtNascVar = input_dtNasc.value;
    var telefoneVar = input_telefone.value;
    var cpfVar = input_cpf.value;
    var generoVar = select_genero.value;



    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo


    // Verificando se há algum campo em branco
    if (
      nomeVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      confirmacaoSenhaVar == "" ||
      dtNascVar == "" ||
      telefoneVar == "" ||
      cpfVar == "" ||
      generoVar == "#"
    ) {
      alert("Preencha todos os campos")
      return;
    }

    if (emailValido && senhaValida)


      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar,
          dtNascServer: dtNascVar,
          telefoneServer: telefoneVar,
          cpfServer: cpfVar,
          generoServer: generoVar
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {

            alert("Cadastro realizado com sucesso!");
            window.location = "login.html"
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
          finalizarAguardar();
        });

    return false;
  }
</script>